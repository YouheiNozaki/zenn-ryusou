---
title: "ãƒ¢ãƒ€ãƒ³JavaScriptã¸ã®ç¬¬ä¸€æ­© ~ã€ŒTwitterAPIã®ãƒ‡ãƒ¼ã‚¿ã‚’CSVã«å‡ºåŠ›ã™ã‚‹ã€åçœç·¨~"
emoji: "ðŸ˜½"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["JavaScript"]
published: false
---

ä»¥å‰[TwitterAPI](https://zenn.dev/ryusou/articles/twitterapi-writecsv)ã«é–¢ã™ã‚‹è¨˜äº‹ã‚’æ›¸ã‹ã›ã¦ã„ãŸã ãã¾ã—ãŸã€‚
ä»Šå›žã¯ãã®ã‚³ãƒ¼ãƒ‰ã§æŒ‡æ‘˜ã‚’å—ã‘ãŸå•é¡Œç‚¹ãªã©ã‚’ã‚‚ã¨ã«ã€JavaScriptã‚’æ›¸ãéš›ã«å¿ƒãŒã‘ã‚‹ã“ã¨ã«ã¤ã„ã¦è€ƒãˆã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ã€‚

ä¸Šè¨˜ã®è¨˜äº‹ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã§ã™ã€‚

```javascript

// ä¸€éƒ¨æŠœç²‹
const data = []

async function searchTweet(count) {
  await client.get('search/tweets', {
    q: `ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ ãƒ•ã‚©ãƒ­ãƒ¼ min_faves:30 min_retweets:100 (filter:images OR filter:link)`,
    count: count,
    tweet_mode: 'extended'
  }, (error, searchData) => {
    if(error) {
      console.log("ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã®ä¸€è¦§å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚")
      console.error(error)
      return error
    }
   searchData.statuses.forEach(tweet => {
      data.push({
        id: tweet.id,
        name: tweet.user.name,
        screen_name: tweet.user.screen_name,
        image_url: tweet.user.profile_image_url,
        created_at: tweet.created_at,
        text: tweet.full_text.replace(/\r?\n/g, ""),
        favorite_count: tweet.favorite_count,
        retweet_count: tweet.retweet_count
      })
    })
    // CSVã«å‡ºåŠ›
    csvWriter
      .writeRecords(data)
      .then(()=> console.log('The CSV file was written successfully'))
    },
  );
}


searchTweet(100)
```

ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã®å•é¡Œç‚¹ã¯ãªã‚“ã§ã—ã‚‡ã†ã‹ï¼Ÿãœã²ã€è€ƒãˆã¦ã¿ã¦ãã ã•ã„ã€‚
è‰²ã€…çªã£è¾¼ã¿ã©ã“ã‚ãŒã‚ã‚Šãã†ã§ã™ãŒã€ä¸€éƒ¨æ›¸ãæ›ãˆãŸä¸­ã§æ„Ÿã˜ãŸè‡ªåˆ†ã®è§£é‡ˆã‚’ä»Šå›žã¯è¿°ã¹ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ã€‚

# 1.ã‚°ãƒ­ãƒ¼ãƒãƒ«ç©ºé–“ã«dataã¨ã„ã†æ±Žç”¨çš„ãªå¤‰æ•°ã‚’å®šç¾©ã—ã¦ã—ã¾ã£ã¦ã„ã‚‹ã€‚
ã¾ãš`const data = []`ã¨ã„ã†ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã‚’searchTweetã®å¤–ã§å®šç¾©ã—ã¦ã„ã¾ã™ã€‚ã“ã®é–¢æ•°ãŒã‚µãƒ¼ãƒ“ã‚¹ã§ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚’è€ƒãˆã‚‹ã¨ã“ã®ã‚ˆã†ãªdataã¨ã„ã†æ±Žç”¨çš„ãªå¤‰æ•°ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«ç©ºé–“ã«å®£è¨€ã™ã‚‹ã¹ãã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
å¤‰æ•°åãŒè¡çªã—ãŸã‚Šã€æ„å›³ã›ãšã«é…åˆ—æ“ä½œãŒã•ã‚Œã¦ã—ã¾ã†æã‚ŒãŒã‚ã‚Šã¾ã™ã€‚
ä¸è¦ãªå¤‰æ•°ã‚’å®šç¾©ã—ãªã„ã‚ˆã†ã«å¿ƒãŒã‘ã‚‹å¿…è¦ãŒã‚ã‚Šãã†ã§ã™ã€‚

# 2.ç ´å£Šçš„ãƒ¡ã‚½ãƒƒãƒ‰ã§ã®é…åˆ—æ“ä½œ
1ã«ã‚‚é–¢ã‚ã‚‹è©±ã§ã™ãŒã€ã„ã‚ã‚†ã‚‹ç ´å£Šçš„ãªãƒ¡ã‚½ãƒƒãƒ‰ã§é…åˆ—æ“ä½œã‚’è¡Œã†ã“ã¨ã¯é¿ã‘ã‚‹ã¹ãã§ã™ã€‚
å‚è€ƒ:https://jsprimer.net/basic/array/#mutable-immutable

data.pushã¯å…ƒã®é…åˆ—ã®å€¤ã®è¦ç´ ã‚’è¿½åŠ ã—ã¦ã€ä¸Šæ›¸ãã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã§ã™ã€‚
ç ´å£Šçš„ãƒ¡ã‚½ãƒƒãƒ‰ã®ä½¿ç”¨ã¯ã•ã‘ã€immutable(éžç ´å£Šçš„)ãªã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã‚ˆã†ã«å¿ƒãŒã‘ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
ã“ã“ã§ã¯é…åˆ—æ“ä½œã«`map`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ã®ãŒè‰¯ã„ã§ã—ã‚‡ã†ã€‚
1.2ã‚’åˆã‚ã›ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã«ãªã‚Šã¾ã™ã€‚

```javascript
const data = searchData.statuses.map(tweet => {
  return {
    id: tweet.id,
    name: tweet.user.name,
    screen_name: tweet.user.screen_name,
    image_url: tweet.user.profile_image_url,
    created_at: tweet.created_at,
    text: tweet.full_text.replace(/\r?\n/g, ""),
    favorite_count: tweet.favorite_count,
    retweet_count: tweet.retweet_count
  }
})
```
