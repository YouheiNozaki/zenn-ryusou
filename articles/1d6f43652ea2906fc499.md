---
title: "nuxt.jsでChartグラフを作るチュートリアル"
emoji: "📊"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["vuejs", "chartjs"]
published: false
---

こんにちは。[りゅーそう](https://twitter.com/ryusou_mtkh)です。

開発に関わらさせていただいているPARKLoTさんで、Chartグラフを作成する機会がありました。

https://id.park-lot.com/

今回はVue.js(nuxt.js)を使ってChartグラフを作る方法を紹介します。
この記事では以下のような(ちょっぴりカッコよさげな)グラフを作っていきます。


![](https://storage.googleapis.com/zenn-user-upload/z55he2kgl21l52z7shyt3c628aez)

# この記事を通して学べること
- axios-mock-serverを使用して、axiosでmockAPIを叩く方法
- nuxt.jsのpageコンポーネントでparamsを取得して使用する方法
- Chart.js(vue-chartjs)を使用してChartを作成する方法
- Chart.jsで作成したグラフをカスタマイズする方法

nuxt.jsの開発環境の構築やVue3.0/compositionAPIなどは扱いません。
(chart.jsがVue3に対応していないため)

# 使用ライブラリなど
関連するライブラリ等
```
  "nuxt": "^2.15.4",
  "vue": "^2.6.12",
  "vue-chartjs": "^3.5.1",
  "chart.js": "^3.0.1",
  "@nuxtjs/axios": "^5.3.6",
  "dayjs": "^1.10.4",
```

# axios-mock-serverでAPIのmockを作成する
nuxt.jsの開発環境が構築されている前提で説明します。
今回グラフに表示させるデータですが、バックエンドのAPIを叩いて表示させても良いのですが、フロントエンドを先に実装したい。技術的な調査を進めたい場合には仮のデータであるmockを作成して、フロントエンド部分のみで開発を進めるのがおすすめです。
nuxt.jsでmockを作成する際はaxios-mock-serverを使用すると簡単にできるのでおすすめです(axiosを利用することが前提にはなってしまいますが)。

https://www.npmjs.com/package/axios-mock-server

設定等は以下のページを参考に進めると良いと思います。
https://qiita.com/m_mitsuhide/items/b8e073cba0dae5af2359

まずはインストール
```
npm install --save-dev axios-mock-server
```

nuxt.jsのpluginsにmockを登録(これからmockディレクトリは作成します)
Nuxtpluginを設定すると各コンポーネントで使用できるようになります。
```javascript:plugins/mock.js
import mock from '~/mocks/$mock.js' // ビルド時に自動生成されるファイル

export default ({ $axios }) => mock($axios)
```
nuxt.config.jsに登録
```js:nuxt.config.js
  plugins: [
    { src: '~/plugins/mock.js' }
  ],
```

package.jsonにスクリプトを追加
正直mockはあくまで開発のためのものなので、正直mock:devコマンド以外使用することはあまりない。
```
  "mock:dev": "axios-mock-server -b && nuxt",
  "mock:build": "axios-mock-server -b && nuxt build",
  "mock:start": "axios-mock-server -b && nuxt start",
  "mock:generate": "axios-mock-server -b && nuxt generate"
```

mockディレクトリにAPIのmockを作成していきます。
axios-mock-serverはnuxt.jsのpages(オートルーティング)と同じように機能します。
例えば、
`mocks/promoters/_promoterId.js`というディレクトリ構成でファイルを作成すると
`/promoters/:id`というAPIが作成されるといった具合です。
(なぜpromotersなのかというとプロジェクトにpromoterというAPIがあったということに他ならないので、皆さんはよしなに作成すると良いです。)
今回は以下のようなAPIを作成しました。

```js:mocks/promoters/_promoterId.js
const data = [
  {
    promoter_id: 1,
    list: [
      { date: "2021-01-01", friends_count: 100, followers_count: 200 },
      { date: "2021-01-02", friends_count: 120, followers_count: 210 },
      { date: "2021-01-03", friends_count: 140, followers_count: 300 },
      { date: "2021-01-04", friends_count: 140, followers_count: 320 },
      { date: "2021-01-05", friends_count: 160, followers_count: 330 },
      { date: "2021-01-06", friends_count: 167, followers_count: 350 },
      { date: "2021-01-07", friends_count: 173, followers_count: 380 },
      { date: "2021-01-08", friends_count: 177, followers_count: 370 },
      { date: "2021-01-09", friends_count: 189, followers_count: 410 },
    ]
  },
  {
    promoter_id: 2,
    list: [
      { date: "2021-01-01", friends_count: 157, followers_count: 200 },
      { date: "2021-01-02", friends_count: 172, followers_count: 222 },
      { date: "2021-01-03", friends_count: 200, followers_count: 234 },
      { date: "2021-01-04", friends_count: 223, followers_count: 277 },
      { date: "2021-01-05", friends_count: 227, followers_count: 312 },
      { date: "2021-01-06", friends_count: 231, followers_count: 380 },
      { date: "2021-01-07", friends_count: 233, followers_count: 392 },
      { date: "2021-01-08", friends_count: 240, followers_count: 402 },
      { date: "2021-01-09", friends_count: 242, followers_count: 407 }
    ]
  }
]

export default {
  get({ values }) {
    return [200, data.find(data => data.promoter_id === values.promoterId)]
  }
}
```
findメソッドでdataの配列から取得したpromoter_idとAPI呼び出し時に取得するidが一致する要素を取得します。このように簡単かつ柔軟にmockを書くことができるのでおすすめです。
以下は全てのpromoterを取得するgetメソッドです。
呼び出す時は`/promoters`で呼び出せます。
```js:mocks/promoters.js
const data = [
  {
    promoter_id: 1,
    list: [
      { date: "2021-01-01", friends_count: 100, followers_count: 200 },
      { date: "2021-01-02", friends_count: 100, followers_count: 210 }
      // 省略
    ]
  },
  {
    promoter_id: 2,
    list: [
      { date: "2021-01-01", friends_count: 150, followers_count: 200 },
      { date: "2021-01-02", friends_count: 200, followers_count: 300 },
      { date: "2021-01-03", friends_count: 300, followers_count: 320 }
      // 省略
    ]
  }
]

export default {
  get: () => [200, data]
}
```
試しにこのmockを叩いてみましょう。promoter_idを取得してみます。
先ほど出てきたようにnuxt.jsではpages配下に作成したファイルはルーティングとして作用します。
例えば,
`pages/chart/index.vue`は`http://localhost..../chart`というようになります。
というわけでこのページを作成してmockを叩いてみます。

```js:pages/chart/index.vue
<template>
  <ul>
    <li v-for="promoter in promoters" :key="promoter.promoter_id">
      <nuxt-link :to="'/chart/' + promoter.promoter_id">
        {{ promoter.promoter_id }}
      </nuxt-link>
    </li>
  </ul>
</template>
<script>

export default {
  async asyncData({ $axios }) {
    const promoters = await $axios.$get("/promoters")

    return { promoters }
  }
}
</script>
```

nuxt.jsの`asyncData`はpages内部のみで使用することが出来ます。
https://ja.nuxtjs.org/docs/2.x/features/data-fetching/#async-data
asyncDataでは非同期でデータを取得し、そのデータをコンポーネントに反映させることが出来ます。

asyncDataの処理で,`$axios`があります。これは`@nuxtjs/axios`です。以下のページを参考にセットアップをすると、各コンポーネントで参照することが出来ます。
https://axios.nuxtjs.org/setup

```
npm install --save @nuxtjs/axios
```

```js:nuxt.config.js
export default {
  modules: ['@nuxtjs/axios']
}
```
create-nuxt-appではaxiosを設定することができるので、create-nuxt-appで設定するのが手取り早いのでおすすめです。
asuncDataでは以下のように$axiosを利用して先ほどのAPIを叩くことが出来ます。取得したデータをreturnしてtemplatesに渡します。
```js
  async asyncData({ $axios }) {
    const promoters = await $axios.$get("/promoters")

    return { promoters }
  }
```
ちなみにasyncDataが使用できないコンポーネントでは、`this.$axios.$get`というように書くことでaxiosにアクセスすることが出来ます。
次にtemplates部分です。v-forでmockから取得した配列データを展開します。
nuxt.jsでページ内リンクを作成するには`NuxtLink`を利用します。
リンク先に以下のように`promoter_id`を渡すことによって`http.../charts/1`のようにページ遷移をすることが出来ます。
```
<template>
  <ul>
    <li v-for="promoter in promoters" :key="promoter.promoter_id">
      <nuxt-link :to="'/chart/' + promoter.promoter_id">
        {{ promoter.promoter_id }}
      </nuxt-link>
    </li>
  </ul>
</template>
```

# nuxt.jsでparamsを取得する方法

